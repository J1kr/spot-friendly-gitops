# apiVersion: argoproj.io/v1alpha1
# kind: Application
# metadata:
#   name: ingress-spot
#   namespace: argocd
# spec:
#   project: default
#   destination:
#     name: spot-friendly
#     namespace: istio-system
#   source:
#     repoURL: https://charts.helm.sh/incubator
#     targetRevision: "0.2.5"
#     chart: raw
#     helm:
#       values: |-
#         resources:
#           - apiVersion: networking.k8s.io/v1
#             kind: Ingress
#             metadata:
#               name: ingress-spot
#               namespace: istio-system
#               annotations:
#                 kubernetes.io/ingress.class: alb
#                 alb.ingress.kubernetes.io/load-balancer-name: "ingress-spot"
#                 alb.ingress.kubernetes.io/scheme: internet-facing
#                 alb.ingress.kubernetes.io/backend-protocol: HTTPS
#                 alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS":443}]'
#                 alb.ingress.kubernetes.io/ssl-redirect: >
#                   {"Type": "redirect", "RedirectConfig": { "Protocol": "HTTPS", "Port": "443", "StatusCode": "HTTP_301"}}
#                 alb.ingress.kubernetes.io/certificate-arn: "arn:aws:acm:ap-northeast-2:105847046109:certificate/5eeafb1a-52ee-4915-b844-50ec5840a652"
#                 alb.ingress.kubernetes.io/healthcheck-path: /healthz/ready
#                 alb.ingress.kubernetes.io/healthcheck-port: "30021"
#                 alb.ingress.kubernetes.io/healthcheck-protocol: "HTTP"
#                 alb.ingress.kubernetes.io/success-codes: "200"
#             spec:
#               rules:
#                 - host: "*.mogki.com"
#                   http:
#                     paths:
#                       - path: /
#                         pathType: Prefix
#                         backend:
#                           service:
#                             name: istio-ingressgateway
#                             port:
#                               number: 443
#                       - path: /
#                         backend:
#                           serviceName: ssl-redirect
#                           servicePort: use-annotation                              
#                 - host: "mogki.com"
#                   http:
#                     paths:
#                       - path: /
#                         pathType: Prefix
#                         backend:
#                           service:
#                             name: istio-ingressgateway
#                             port:
#                               number: 443
#                       - path: /
#                         backend:
#                           serviceName: ssl-redirect
#                           servicePort: use-annotation
#   syncPolicy:
#     automated:
#       selfHeal: true
#       prune: true
#     syncOptions:
#       - CreateNamespace=true